# 4. Vagrant におけるネットワーク

Vagrant は、柔軟性を最大限に発揮できるよう、3つの選択肢をネットワークに関して提供して
います。

- フォワードされたポート
- ホストのみのネットワーク (V2ではプライベートネットワーク)
- ブリッジされたネットワーク

### 4.1 フォワードされたポート

ホストのポートをゲスト上のポートにフォワードするので、ゲストのIPを指定せずにサービスに
アクセスできるようになる。

1つの例として、仮にゲストのポート80をホストのポート8080にフォワードしたなら、メインマ
シンで `localhost:8080` を読み込めば、ゲストのWebサーバーにアクセスできるでしょう。


#### 4.1.1 長所と短所

##### 長所

- セットアップが非常にシンプル


##### 短所

- フォワードしたいポートは、すべて明示的に指定しなければならない


フォワードされたポートは、使っているコンピュータそのものの外からもアクセスできます。
使っているコンピュータでファイアウォールが動作していなければ、そのコンピュータのIPと待
ち受け使われているポートがわかれば、ローカルネットワーク内の任意のコンピュータがその仮
想マシンにアクセスできます。


#### 4.1.2 基本的な使用方法

```ruby
config.vm.forward_port 80, 8080
```

これらの定義の変更は、`vagrant reload` とするまでは、実行中のマシンに影響しない


#### 4.1.3 衝突の検出と修正

Vagrant には、ポートの衝突検出機能が組み込まれています。ポートが衝突するのは、ポートの
定義がシステム上ですでに使われているポートとぶつかってしまった場合です。

- デフォルトでは、Vagrant はエラーを表示する
- 自動的に衝突を回避することもできる

```ruby
# 自動でポートの衝突を避ける
config.vm.forward_port 80, 8080, auto_correct: true
```

Vagrant は自動修正用のポートを、`2200` から `2250` の間で選択します。
この範囲も、Vagrantfile の設定でカスタマイズ可能です

```ruby
config.vm.usable_port_range = (2200..2250)
```


#### 4.1.4 TCP 対 UDP

デフォルトでは、フォワードされたポートはTCP接続を対象とする。
UDPパケットもフォワードしたい場合は、UDPポートフォワードの設定を追加する必要がある。

```ruby
conifg.vm.forward_port 80, 8080, protocol: 'udp'
```

これは UDPパケットだけをフォワードします。どちらのプロトコルもフォワードしたい場合は、
2つのフォワードポートの宣言が必要となる。


## 4.2 ホストのみのネットワーク



### 4.2.1 長所と短所
